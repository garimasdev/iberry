<link rel="stylesheet" type="text/css" href="/static/css/includes/sub_menu.css">

<div class="top-back-and-types">

    <!-- <button id="back_btn_basehtml" type="button" onclick="history.back()" class="back-btn">
        <i class="bi bi-arrow-left-short"></i> 
        <span >Back</span>
    </button> -->

    
    <!--another button-->
    
    <ul class="item-types">
        
        {% if '/store/'|add:room_number|add:'/foods/items/' in request.path or '/store/'|add:room_number|add:'/foods/outdoor_items/' in request.path  or '/store/'|add:room_number|add:'/foods/bar/' in request.path %}

        <!-- search box -->
        <li class="search-box-item">
            <div class="search-container">
                <form action="" method="get" class="search-box" autocomplete="off">
                    <input type="hidden" name="csrfmiddlewaretoken" value="ab98vXIBj50QuHOYiMihpbEGnQMFol64SkD8ntN1OEjpcN2gVyJcgGSScvwNMgHH">
                    <i class="bi bi-search" id="search-icon"></i>
                    <!-- <div>
                        <input type="text" class="search-text" name="q" list="suggestions" placeholder="Search...">
                        <div id="suggestions" class="autocomplete-results" style="display: block; height: auto; top: 117px; bottom: 0px; position: absolute; z-index: 99; background: white;"></div>
                    </div>  -->
                    <input type="text" class="search-text" name="q" list="suggestions" placeholder="Search...">
                    <div id="suggestions" class="autocomplete-results" style="display: block; height: 250px; overflow-y: auto; top: 117px; bottom: 0px; position: absolute; z-index: 99; background: white; cursor: pointer;">
                    <!-- <datalist id="suggestions"></datalist> -->
                </form>
            </div>
        </li>
    {%endif%}        
        
        {% if business_type == 0 %}
        {% if '/foods/bar/' not in request.path %}
        
        <!-- veg category -->
        <li class="item-type veg {%if request.GET.item_type == 'Veg' %}active{%endif%}">
            <a href="{%if request.GET %}
            {% if "item_type=Veg" not in current_params %}
            {{ request.path }}?{{ current_params }}&item_type=Veg
            {% else %}{{ request.path }}?{{ current_params }} {% endif %}
            {% else %}{{ request.path }}?item_type=Veg{% endif %}">
                <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512">
                <path d="M346.7 6C337.6 17 320 42.3 320 72c0 40 15.3 55.3 40 80s40 40 80 40c29.7 0 55-17.6 66-26.7c4-3.3 6-8.2 6-13.3s-2-10-6-13.2c-11.4-9.1-38.3-26.8-74-26.8c-32 0-40 8-40 8s8-8 8-40c0-35.7-17.7-62.6-26.8-74C370 2 365.1 0 360 0s-10 2-13.3 6zM244.6 136c-40 0-77.1 18.1-101.7 48.2l60.5 60.5c6.2 6.2 6.2 16.4 0 22.6s-16.4 6.2-22.6 0l-55.3-55.3 0 .1L2.2 477.9C-2 487-.1 497.8 7 505s17.9 9 27.1 4.8l134.7-62.4-52.1-52.1c-6.2-6.2-6.2-16.4 0-22.6s16.4-6.2 22.6 0L199.7 433l100.2-46.4c46.4-21.5 76.2-68 76.2-119.2C376 194.8 317.2 136 244.6 136z"/></svg>
                <span>Veg</span>
            </a>
        </li>

        
        <!-- non-veg category -->
        <li class="item-type non-veg {%if request.GET.item_type == 'Non Veg' %}active{%endif%}">
            <a href="{%if request.GET %}
            {% if "item_type=Non Veg" not in current_params %}
            {{ request.path }}?{{ current_params }}&item_type=Non Veg
            {% else %}{{ request.path }}?{{ current_params }} {% endif %}
            {% else %}{{ request.path }}?item_type=Non Veg{% endif %}">
                <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512">
                <path d="M61.1 224C45 224 32 211 32 194.9c0-1.9 .2-3.7 .6-5.6C37.9 168.3 78.8 32 256 32s218.1 136.3 223.4 157.3c.5 1.9 .6 3.7 .6 5.6c0 16.1-13 29.1-29.1 29.1H61.1zM144 128a16 16 0 1 0 -32 0 16 16 0 1 0 32 0zm240 16a16 16 0 1 0 0-32 16 16 0 1 0 0 32zM272 96a16 16 0 1 0 -32 0 16 16 0 1 0 32 0zM16 304c0-26.5 21.5-48 48-48H448c26.5 0 48 21.5 48 48s-21.5 48-48 48H64c-26.5 0-48-21.5-48-48zm16 96c0-8.8 7.2-16 16-16H464c8.8 0 16 7.2 16 16v16c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V400z"/></svg>
                <span>Non Veg</span>
            </a>
        </li>
        
        {%endif%}
        {%endif%}
        
        {% if '/store/'|add:room_number|add:'/foods/items/' in request.path or '/store/'|add:room_number|add:'/foods/outdoor_items/' in request.path or '/store/'|add:room_number|add:'/foods/bar/' in request.path %}
        <!-- Day Deal category -->
        <li class="item-type day-deal {%if request.GET.item_type == 'Day Deal' %}active{%endif%}">
            <a href="{%if request.GET %}
            {% if "item_type=Day Deal" not in current_params %}
            {{ request.path }}?{{ current_params }}&item_type=Day Deal
            {% else %}{{ request.path }}?{{ current_params }} {% endif %}
            {% else %}{{ request.path }}?item_type=Day Deal{% endif %}">
                <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512">
                <path d="M374.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-320 320c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l320-320zM128 128A64 64 0 1 0 0 128a64 64 0 1 0 128 0zM384 384a64 64 0 1 0 -128 0 64 64 0 1 0 128 0z"/></svg>
                <span>Day Deal</span>
            </a>
        </li>
        {%endif%}
    </ul>

    
</div>


<!-- collapse and expand search box -->
<!-- search box suggestion -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchIcon = document.getElementById('search-icon');
        const searchBox = document.querySelector('.search-box');
        const searchInput = document.querySelector('.search-text');
        const container = document.getElementById('suggestions');
        const temp = document.getElementById('categories-items');

        searchInput.focus();

        // searchInput.addEventListener('focus', () => {
        //     const temp = document.getElementById('categories-items');
        //     temp.classList.remove('categories-item-list');
        // });focusout

        searchInput.addEventListener('focusout', () => {
            console.log('css');
            if (temp.classList.contains('categories-item-list')) {
                temp.classList.remove('categories-item-list');
            } else {
                temp.classList.add('categories-item-list');
            }
            
        });

        function fetchSuggestions(query) {
            var data = {
                q: query,
                outdoor_token: '{{room_number}}'
            };
            
            fetch("{% url 'stores:search-suggestions' %}", {
                method: 'POST',
                headers: {
                'X-CSRFToken': '{{csrf_token}}'
            },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(results => {
                    const suggestions = results.data
                    displaySuggestions(suggestions);
                });
        }
    
        function displaySuggestions(suggestions) {
            if (suggestions.length === 0) {
                container.style.display = 'none';
                return;
            }
            container.innerHTML = ''; // Clear the existing suggestions
            suggestions.forEach(suggestion => {
                const suggestionItem = document.createElement('div');
                suggestionItem.textContent = suggestion.title;
                // Add padding or margin to the suggestion item
                suggestionItem.style.padding = '10px';
                suggestionItem.style.margin = '2px 0';

                suggestionItem.addEventListener('click', () => {
                    searchInput.value = suggestion.title;
                    container.style.display = 'none';
                });

                container.appendChild(suggestionItem);
            });
            container.style.display = 'block'; // Show the container
        }
    
        searchIcon.addEventListener('click', function() {
            searchBox.classList.toggle('expanded');
            temp.classList.toggle('categories-item-list');
        });
    
        searchInput.addEventListener('input', function() {
            const query = searchInput.value.trim();
            if (query) {
                fetchSuggestions(query);
            } else {
                container.innerHTML = '';
                container.style.display = 'none';
            }
        });
    
        document.addEventListener('click', function(event) {
            if (!searchBox.contains(event.target) && event.target !== searchIcon) {
                searchBox.classList.remove('expanded');
                container.style.display = 'none';
            }
        });
    });
</script>
    